{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-dropzone",
  "type": "registry:component",
  "title": "File Dropzone",
  "description": "A drag-and-drop file upload component with image preview, validation, and error handling.",
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "registry/joyco/blocks/file-dropzone.tsx",
      "content": "'use client'\n\nimport {\n  AlertCircleIcon,\n  FileIcon,\n  ImageIcon,\n  UploadIcon,\n  XIcon,\n} from 'lucide-react'\n\nimport { Button } from '@/components/ui/button'\nimport { useFileUpload } from '@/hooks/use-file-upload'\n\nexport interface FileDropzoneProps {\n  accept?: string\n  maxSizeMB?: number\n  maxFiles?: number\n  multiple?: boolean\n  onUpload?: (file: File) => Promise<unknown> | void\n}\n\nexport const FileDropzone = ({\n  accept,\n  maxSizeMB = 2,\n  maxFiles,\n  multiple = false,\n  onUpload,\n}: FileDropzoneProps) => {\n  const maxSize = maxSizeMB * 1024 * 1024\n  const finalMaxFiles = maxFiles ?? (multiple ? 5 : 1)\n\n  const {\n    files,\n    isDragging,\n    errors,\n    handleDragEnter,\n    handleDragLeave,\n    handleDragOver,\n    handleDrop,\n    openFileDialog,\n    removeFile,\n    getInputProps,\n  } = useFileUpload({\n    accept,\n    maxSize,\n    maxFiles: finalMaxFiles,\n    onUpload,\n  })\n\n  const previewUrl = files[0]?.preview || null\n  const uploadedFile = files[0]?.file || null\n  const hasFiles = files.length > 0\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      <div className=\"relative\">\n        {/* Drop area */}\n        <div\n          className=\"border-input has-[input:focus]:border-ring has-[input:focus]:ring-ring/50 data-[dragging=true]:bg-accent/50 relative flex min-h-52 flex-col items-center justify-center overflow-hidden rounded-xl border border-dashed p-4 transition-colors has-[input:focus]:ring-[3px]\"\n          data-dragging={isDragging || undefined}\n          onDragEnter={handleDragEnter}\n          onDragLeave={handleDragLeave}\n          onDragOver={handleDragOver}\n          onDrop={handleDrop}\n        >\n          <input\n            {...getInputProps()}\n            aria-label=\"Upload file\"\n            className=\"sr-only\"\n          />\n          {/* Single file mode: show file inside drop area */}\n          {!multiple && uploadedFile ? (\n            <div className=\"absolute inset-0 flex items-center justify-center p-4\">\n              {previewUrl ? (\n                <img\n                  alt={uploadedFile.name || 'Uploaded file'}\n                  className=\"mx-auto max-h-full rounded object-contain\"\n                  src={previewUrl}\n                />\n              ) : (\n                <div className=\"flex flex-col items-center justify-center gap-2 text-center\">\n                  <div\n                    aria-hidden=\"true\"\n                    className=\"bg-background flex size-16 shrink-0 items-center justify-center rounded-full border\"\n                  >\n                    <FileIcon className=\"size-8 opacity-60\" />\n                  </div>\n                  <p className=\"text-sm font-medium\">{uploadedFile.name}</p>\n                  <p className=\"text-muted-foreground text-xs\">\n                    {uploadedFile.size < 1024 * 1024\n                      ? `${(uploadedFile.size / 1024).toFixed(0)} KB`\n                      : `${(uploadedFile.size / 1024 / 1024).toFixed(2)} MB`}\n                  </p>\n                </div>\n              )}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center px-4 py-3 text-center\">\n              <div\n                aria-hidden=\"true\"\n                className=\"bg-background mb-2 flex size-11 shrink-0 items-center justify-center rounded-full border\"\n              >\n                <ImageIcon className=\"size-4 opacity-60\" />\n              </div>\n              <p className=\"mb-1.5 text-sm font-medium\">\n                Drop your {multiple ? 'files' : 'file'} here\n              </p>\n              <p className=\"text-muted-foreground text-xs\">\n                {accept ? `${accept.split(',').join(', ')} ` : 'Any file type '}\n                (max. {maxSizeMB}MB)\n                {multiple &&\n                  finalMaxFiles > 1 &&\n                  ` Â· Up to ${finalMaxFiles} files`}\n              </p>\n              <Button\n                className=\"mt-4\"\n                onClick={openFileDialog}\n                variant=\"outline\"\n              >\n                <UploadIcon\n                  aria-hidden=\"true\"\n                  className=\"-ms-1 size-4 opacity-60\"\n                />\n                Select {multiple ? 'files' : 'file'}\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {/* Remove button for single file mode */}\n        {!multiple && uploadedFile && (\n          <div className=\"absolute top-4 right-4\">\n            <button\n              aria-label=\"Remove file\"\n              className=\"focus-visible:border-ring focus-visible:ring-ring/50 z-50 flex size-8 cursor-pointer items-center justify-center rounded-full bg-black/60 text-white transition-[color,box-shadow] outline-none hover:bg-black/80 focus-visible:ring-[3px]\"\n              onClick={() => removeFile(files[0]?.id)}\n              type=\"button\"\n            >\n              <XIcon aria-hidden=\"true\" className=\"size-4\" />\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Error messages */}\n      {errors.length > 0 && (\n        <div\n          className=\"text-destructive flex items-center gap-1 text-xs\"\n          role=\"alert\"\n        >\n          <AlertCircleIcon className=\"size-3 shrink-0\" />\n          <span>{errors[0]}</span>\n        </div>\n      )}\n\n      {/* Uploaded files list for multiple mode */}\n      {multiple && hasFiles && (\n        <div className=\"space-y-2\">\n          {files.map((fileWithPreview) => {\n            const { id, file, preview } = fileWithPreview\n            return (\n              <div\n                key={id}\n                className=\"bg-muted/50 border-border relative flex items-center gap-3 rounded-lg border p-3\"\n              >\n                {preview ? (\n                  <img\n                    src={preview}\n                    alt={file.name}\n                    className=\"size-10 shrink-0 rounded object-cover\"\n                  />\n                ) : (\n                  <div className=\"bg-background flex size-10 shrink-0 items-center justify-center rounded border\">\n                    <FileIcon className=\"size-4 opacity-60\" />\n                  </div>\n                )}\n                <div className=\"min-w-0 flex-1\">\n                  <p className=\"truncate text-sm font-medium\">{file.name}</p>\n                  <p className=\"text-muted-foreground text-xs\">\n                    {file.size < 1024 * 1024\n                      ? `${(file.size / 1024).toFixed(0)} KB`\n                      : `${(file.size / 1024 / 1024).toFixed(2)} MB`}\n                  </p>\n                </div>\n                <button\n                  onClick={() => removeFile(id)}\n                  aria-label={`Remove ${file.name}`}\n                  className=\"text-muted-foreground hover:text-destructive shrink-0 transition-colors\"\n                  type=\"button\"\n                >\n                  <XIcon className=\"size-4\" />\n                </button>\n              </div>\n            )\n          })}\n        </div>\n      )}\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "hooks/use-file-upload.tsx",
      "content": "import { useCallback, useId, useRef, useState } from 'react'\n\nexport interface FileWithPreview {\n  id: string\n  file: File\n  preview?: string\n}\n\nexport interface UseFileUploadOptions {\n  accept?: string\n  maxSize?: number\n  maxFiles?: number\n  onUpload?: (file: File) => Promise<unknown> | void\n}\n\nexport interface UseFileUploadReturn {\n  files: FileWithPreview[]\n  errors: string[]\n  isDragging: boolean\n  removeFile: (id: string) => void\n  openFileDialog: () => void\n  getInputProps: () => {\n    ref: React.RefObject<HTMLInputElement | null>\n    type: 'file'\n    id: string\n    accept?: string\n    multiple: boolean\n    onChange: (event: React.ChangeEvent<HTMLInputElement>) => Promise<void>\n  }\n  handleDragEnter: (e: React.DragEvent) => void\n  handleDragLeave: (e: React.DragEvent) => void\n  handleDragOver: (e: React.DragEvent) => void\n  handleDrop: (e: React.DragEvent) => void\n}\n\nexport function useFileUpload(\n  options: UseFileUploadOptions = {}\n): UseFileUploadReturn {\n  const { accept, maxSize, maxFiles = 1, onUpload } = options\n\n  const id = useId()\n  const inputRef = useRef<HTMLInputElement>(null)\n  const dragCounterRef = useRef(0)\n\n  const [files, setFiles] = useState<FileWithPreview[]>([])\n  const [errors, setErrors] = useState<string[]>([])\n  const [isDragging, setIsDragging] = useState(false)\n\n  const validateFile = useCallback(\n    (file: File): string | null => {\n      if (accept) {\n        const acceptedTypes = accept.split(',').map((t) => t.trim())\n        const fileType = file.type\n        const isAccepted = acceptedTypes.some((type) => {\n          if (type.endsWith('/*')) {\n            return fileType.startsWith(type.replace('/*', ''))\n          }\n          return fileType === type\n        })\n\n        if (!isAccepted) {\n          return `File type not accepted. Allowed: ${accept}`\n        }\n      }\n\n      if (maxSize && file.size > maxSize) {\n        const maxSizeMB = (maxSize / (1024 * 1024)).toFixed(1)\n        return `File too large. Max size: ${maxSizeMB}MB`\n      }\n\n      return null\n    },\n    [accept, maxSize]\n  )\n\n  const createPreview = useCallback(\n    (file: File): Promise<string | undefined> => {\n      return new Promise((resolve) => {\n        if (file.type.startsWith('image/')) {\n          const reader = new FileReader()\n          reader.onloadend = () => resolve(reader.result as string)\n          reader.onerror = () => resolve(undefined)\n          reader.readAsDataURL(file)\n        } else {\n          resolve(undefined)\n        }\n      })\n    },\n    []\n  )\n\n  const processFiles = useCallback(\n    async (fileList: FileList | File[]) => {\n      const filesArray = Array.from(fileList)\n      const newErrors: string[] = []\n      const validFiles: FileWithPreview[] = []\n\n      for (const file of filesArray) {\n        const error = validateFile(file)\n        if (error) {\n          newErrors.push(error)\n          continue\n        }\n\n        const preview = await createPreview(file)\n\n        validFiles.push({\n          id: `${Date.now()}-${Math.random()}`,\n          file,\n          preview,\n        })\n\n        if (onUpload) {\n          await onUpload(file)\n        }\n      }\n\n      setErrors(newErrors)\n      setFiles((prev) => {\n        const combined = [...prev, ...validFiles]\n        return combined.slice(0, maxFiles)\n      })\n    },\n    [validateFile, createPreview, onUpload, maxFiles]\n  )\n\n  const removeFile = useCallback((fileId: string) => {\n    setFiles((prev) => prev.filter((f) => f.id !== fileId))\n  }, [])\n\n  const openFileDialog = useCallback(() => {\n    inputRef.current?.click()\n  }, [])\n\n  const handleFileChange = useCallback(\n    async (event: React.ChangeEvent<HTMLInputElement>) => {\n      const fileList = event.target.files\n      if (fileList && fileList.length > 0) {\n        await processFiles(fileList)\n      }\n      event.target.value = ''\n    },\n    [processFiles]\n  )\n\n  const getInputProps = useCallback(() => {\n    return {\n      ref: inputRef,\n      type: 'file' as const,\n      id: `${id}-file-input`,\n      accept,\n      multiple: maxFiles > 1,\n      onChange: handleFileChange,\n    }\n  }, [id, accept, maxFiles, handleFileChange])\n\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    dragCounterRef.current++\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\n      setIsDragging(true)\n    }\n  }, [])\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    dragCounterRef.current--\n    if (dragCounterRef.current === 0) {\n      setIsDragging(false)\n    }\n  }, [])\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n  }, [])\n\n  const handleDrop = useCallback(\n    async (e: React.DragEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      setIsDragging(false)\n      dragCounterRef.current = 0\n\n      const fileList = e.dataTransfer.files\n      if (fileList && fileList.length > 0) {\n        await processFiles(fileList)\n      }\n    },\n    [processFiles]\n  )\n\n  return {\n    files,\n    errors,\n    isDragging,\n    removeFile,\n    openFileDialog,\n    getInputProps,\n    handleDragEnter,\n    handleDragLeave,\n    handleDragOver,\n    handleDrop,\n  }\n}\n",
      "type": "registry:hook"
    }
  ]
}